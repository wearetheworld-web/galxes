(window.webpackJsonp=window.webpackJsonp||[]).push([[1115],{229:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return _r})),r.d(t,"b",(function(){return Ut})),r.d(t,"c",(function(){return wt})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return mr}));r(30),r(43),r(111),r(116),r(58);var n=r(202),o=r(52),c=r(19),l=r(24),h=r(17),f=r(8),d=r(1),m=r(15),v=r(11),y=r(12),x=(r(66),r(450),r(16),r(515),r(516),r(517),r(518),r(519),r(520),r(521),r(522),r(523),r(524),r(525),r(526),r(527),r(528),r(529),r(530),r(531),r(532),r(533),r(534),r(535),r(536),r(537),r(538),r(1186),r(823),r(1005),r(393),r(46),r(48),r(2084),r(87),r(39),r(713),r(107),r(73),r(1182),r(322),r(323),r(324),r(325),r(326),r(327),r(328),r(329),r(330),r(331),r(332),r(333),r(334),r(335),r(77),r(85),r(37),r(86),r(71),r(91),r(36),r(51),r(42),r(114),r(232),r(336),r(546),r(547),r(548),r(549),r(550),r(551),r(552),r(553),r(554),r(555),r(556),r(557),r(558),r(559),r(560),r(561),r(562),r(83)),w=r.n(x),O=r(1304),k=r.n(O),j=r(509),R=r(79),E=r(194),I=r(192),P=r(510),_=r(5),S=r(113),z=r(47),T=r(259),C=r(57),A=r(1305),L=r(1306),D=r.n(L);function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var o=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}function U(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function K(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function V(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?K(Object(source),!0).forEach((function(t){Object(m.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):K(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var B=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),a=n.charCodeAt(0);if(255!==r[a])throw new TypeError(n+" is ambiguous");r[a]=s}var o=e.length,c=e.charAt(0),l=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function b(u){if("string"!=typeof u)throw new TypeError("Expected String");if(0===u.length)return new Uint8Array;var e=0;if(" "!==u[e]){for(var t=0,n=0;u[e]===c;)t++,e++;for(var h=(u.length-e)*l+1>>>0,f=new Uint8Array(h);u[e];){var d=r[u.charCodeAt(e)];if(255===d)return;for(var m=0,v=h-1;(0!==d||m<n)&&-1!==v;v--,m++)d+=o*f[v]>>>0,f[v]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");n=m,e++}if(" "!==u[e]){for(var y=h-n;y!==h&&0===f[y];)y++;for(var x=new Uint8Array(t+(h-y)),w=t;y!==h;)x[w++]=f[y++];return x}}}return{encode:function(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===u.length)return"";for(var t=0,r=0,n=0,l=u.length;n!==l&&0===u[n];)n++,t++;for(var f=(l-n)*h+1>>>0,d=new Uint8Array(f);n!==l;){for(var m=u[n],v=0,y=f-1;(0!==m||v<r)&&-1!==y;y--,v++)m+=256*d[y]>>>0,d[y]=m%o>>>0,m=m/o>>>0;if(0!==m)throw new Error("Non-zero carry");r=v,n++}for(var x=f-r;x!==f&&0===d[x];)x++;for(var w=c.repeat(t);x<f;++x)w+=e.charAt(d[x]);return w},decodeUnsafe:b,decode:function(u){var e=b(u);if(e)return e;throw new Error("Non-".concat(t," character"))}}},J=function(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},H=function(){function e(t,r,i){Object(v.a)(this,e),this.name=t,this.prefix=r,this.baseEncode=i}return Object(y.a)(e,[{key:"encode",value:function(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}]),e}(),W=function(){function e(t,r,i){if(Object(v.a)(this,e),this.name=t,this.prefix=r,void 0===r.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}return Object(y.a)(e,[{key:"decode",value:function(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}},{key:"or",value:function(e){return F(this,e)}}]),e}(),Y=function(){function e(t){Object(v.a)(this,e),this.decoders=t}return Object(y.a)(e,[{key:"or",value:function(e){return F(this,e)}},{key:"decode",value:function(e){var t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}]),e}(),F=function(e,t){return new Y(V(V({},e.decoders||Object(m.a)({},e.prefix,e)),t.decoders||Object(m.a)({},t.prefix,t)))},G=function(){function e(t,r,i,s){Object(v.a)(this,e),this.name=t,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new H(t,r,i),this.decoder=new W(t,r,s)}return Object(y.a)(e,[{key:"encode",value:function(e){return this.encoder.encode(e)}},{key:"decode",value:function(e){return this.decoder.decode(e)}}]),e}(),q=function(e){var t=e.name,r=e.prefix,n=e.encode,i=e.decode;return new G(t,r,n,i)},Z=function(e){var t=e.prefix,r=e.name,n=e.alphabet,o=B(n,r),i=o.encode,s=o.decode;return q({prefix:t,name:r,encode:i,decode:function(e){return J(s(e))}})},p=function(e){var t=e.name,r=e.prefix,n=e.bitsPerChar,i=e.alphabet;return q({prefix:r,name:t,encode:function(s){return function(e,t,r){for(var i="="===t[t.length-1],s=(1<<r)-1,n="",a=0,o=0,c=0;c<e.length;++c)for(o=o<<8|e[c],a+=8;a>r;)n+=t[s&o>>(a-=r)];if(a&&(n+=t[s&o<<r-a]),i)for(;n.length*r&7;)n+="=";return n}(s,i,n)},decode:function(s){return function(e,t,r,i){for(var s={},n=0;n<t.length;++n)s[t[n]]=n;for(var o=e.length;"="===e[o-1];)--o;for(var a=new Uint8Array(o*r/8|0),c=0,l=0,h=0,f=0;f<o;++f){var d=s[e[f]];if(void 0===d)throw new SyntaxError("Non-".concat(i," character"));l=l<<r|d,(c+=r)>=8&&(c-=8,a[h++]=255&l>>c)}if(c>=r||255&l<<8-c)throw new SyntaxError("Unexpected end of data");return a}(s,i,n,t)}})},Q=q({prefix:"\0",name:"identity",encode:function(e){return function(e){return(new TextDecoder).decode(e)}(e)},decode:function(e){return function(e){return(new TextEncoder).encode(e)}(e)}}),X=Object.freeze({__proto__:null,identity:Q}),$=p({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ee=Object.freeze({__proto__:null,base2:$}),te=p({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),re=Object.freeze({__proto__:null,base8:te}),ne=Z({prefix:"9",name:"base10",alphabet:"0123456789"}),ie=Object.freeze({__proto__:null,base10:ne}),ae=p({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),se=p({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),oe=Object.freeze({__proto__:null,base16:ae,base16upper:se}),ce=p({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ue=p({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pe=p({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),le=p({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),he=p({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ge=p({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),fe=p({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),de=p({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),be=p({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),me=Object.freeze({__proto__:null,base32:ce,base32upper:ue,base32pad:pe,base32padupper:le,base32hex:he,base32hexupper:ge,base32hexpad:fe,base32hexpadupper:de,base32z:be}),ve=Z({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ye=Z({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),xe=Object.freeze({__proto__:null,base36:ve,base36upper:ye}),we=Z({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Oe=Z({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ke=Object.freeze({__proto__:null,base58btc:we,base58flickr:Oe}),je=p({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Re=p({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ee=p({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ie=p({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Pe=Object.freeze({__proto__:null,base64:je,base64pad:Re,base64url:Ee,base64urlpad:Ie}),_e=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Se=_e.reduce((function(e,t,r){return e[r]=t,e}),[]),ze=_e.reduce((function(e,t,r){return e[t.codePointAt(0)]=r,e}),[]);var Te=q({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((function(e,t){return e+=Se[t]}),"")},decode:function(e){var t,r=[],n=U(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,i=ze[o.codePointAt(0)];if(void 0===i)throw new Error("Non-base256emoji character: ".concat(o));r.push(i)}}catch(e){n.e(e)}finally{n.f()}return new Uint8Array(r)}}),Ce=Object.freeze({__proto__:null,base256emoji:Te}),Ae=function e(t,r,n){r=r||[];for(var i=n=n||0;t>=Le;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Le=Math.pow(2,31);var De=function e(t,i){var a,r=0,s=0,n=i=i||0,o=t.length;do{if(n>=o)throw e.bytes=0,new RangeError("Could not decode varint");a=t[n++],r+=s<28?(127&a)<<s:(127&a)*Math.pow(2,s),s+=7}while(a>=128);return e.bytes=n-i,r};var Ne=Math.pow(2,7),Ue=Math.pow(2,14),Me=Math.pow(2,21),Ke=Math.pow(2,28),qe=Math.pow(2,35),Ve=Math.pow(2,42),Be=Math.pow(2,49),Je=Math.pow(2,56),He=Math.pow(2,63),We={encode:Ae,decode:De,encodingLength:function(e){return e<Ne?1:e<Ue?2:e<Me?3:e<Ke?4:e<qe?5:e<Ve?6:e<Be?7:e<Je?8:e<He?9:10}},Ye=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return We.encode(e,t,r),t},Fe=function(e){return We.encodingLength(e)},Ge=function(e,t){var r=t.byteLength,i=Fe(e),s=i+Fe(r),n=new Uint8Array(s+r);return Ye(e,n,0),Ye(r,n,i),n.set(t,s),new Ze(e,r,t,n)},Ze=Object(y.a)((function e(t,r,i,s){Object(v.a)(this,e),this.code=t,this.size=r,this.digest=i,this.bytes=s})),Qe=function(e){var t=e.name,r=e.code,n=e.encode;return new Xe(t,r,n)},Xe=function(){function e(t,r,i){Object(v.a)(this,e),this.name=t,this.code=r,this.encode=i}return Object(y.a)(e,[{key:"digest",value:function(e){var t=this;if(e instanceof Uint8Array){var r=this.encode(e);return r instanceof Uint8Array?Ge(this.code,r):r.then((function(i){return Ge(t.code,i)}))}throw Error("Unknown type, must be binary type")}}]),e}(),$e=function(e){return function(){var t=Object(d.a)(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,crypto.subtle.digest(e,r);case 3:return t.t1=t.sent,t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},et=Qe({name:"sha2-256",code:18,encode:$e("SHA-256")}),tt=Qe({name:"sha2-512",code:19,encode:$e("SHA-512")}),nt=Object.freeze({__proto__:null,sha256:et,sha512:tt}),it=J,at={code:0,name:"identity",encode:it,digest:function(e){return Ge(0,it(e))}},tr=Object.freeze({__proto__:null,identity:at});new TextEncoder,new TextDecoder;var st=V(V(V(V(V(V(V(V(V(V({},X),ee),re),ie),oe),me),xe),ke),Pe),Ce);function ot(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function ct(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}V(V({},nt),tr);var ut=ct("utf8","u",(function(e){return"u"+new TextDecoder("utf8").decode(e)}),(function(e){return(new TextEncoder).encode(e.substring(1))})),pt=ct("ascii","a",(function(e){for(var t="a",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(function(e){for(var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?ot(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),lt=V({utf8:ut,"utf-8":ut,hex:st.base16,latin1:pt,ascii:pt,binary:pt},st);function ht(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=lt[t];if(!r)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode("".concat(r.prefix).concat(e)):ot(globalThis.Buffer.from(e,"utf-8"))}var gt="core",ft="".concat("wc","@2:").concat(gt,":"),bt="error",mt={database:":memory:"},vt="client_ed25519_seed",yt=z.ONE_DAY,xt=z.SIX_HOURS,wt="irn",Ot="wss://relay.walletconnect.com",g={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},kt="payload",jt="connect",Rt="disconnect",Et="error",It=z.ONE_SECOND/2,Pt="subscription_created",_t="subscription_deleted",St="subscription_sync",zt="subscription_resubscribed",Tt=(z.THIRTY_DAYS,1e3*z.FIVE_SECONDS),Ct=(z.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}}),At="history_created",Lt="history_updated",Dt="history_deleted",Nt="history_sync",Ut={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Mt=(z.ONE_DAY,"verify-api"),Kt="https://verify.walletconnect.com",qt=function(){function e(t,r){var n=this;Object(v.a)(this,e),this.core=t,this.logger=r,this.keychain=new Map,this.name="keychain",this.version="0.3",this.initialized=!1,this.storagePrefix=ft,this.init=Object(d.a)(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.initialized){e.next=5;break}return e.next=3,n.getKeyChain();case 3:i=e.sent,Object(f.a)(i)<"u"&&(n.keychain=i),n.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.has=function(i){return n.isInitialized(),n.keychain.has(i)},this.set=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.keychain.set(i,s),e.next=4,n.persist();case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.get=function(i){n.isInitialized();var s=n.keychain.get(i);if(Object(f.a)(s)>"u"){var e=Object(_.t)("NO_MATCHING_KEY","".concat(n.name,": ").concat(i)).message;throw new Error(e)}return s},this.del=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.keychain.delete(i),e.next=4,n.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=Object(R.generateChildLogger)(r,this.name)}var t,r,n;return Object(y.a)(e,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setKeyChain",value:(n=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,Object(_.fb)(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getKeyChain",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",Object(f.a)(t)<"u"?Object(_.hb)(t):void 0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"persist",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setKeyChain(this.keychain);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}(),Vt=function(){function e(t,r,i){var n=this;Object(v.a)(this,e),this.core=t,this.logger=r,this.name="crypto",this.initialized=!1,this.init=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.initialized,e.t0){e.next=5;break}return e.next=4,n.keychain.init();case 4:n.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.hasKeys=function(s){return n.isInitialized(),n.keychain.has(s)},this.getClientId=Object(d.a)(regeneratorRuntime.mark((function e(){var s,t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.getClientSeed();case 3:return s=e.sent,t=P.generateKeyPair(s),e.abrupt("return",P.encodeIss(t.publicKey));case 6:case"end":return e.stop()}}),e)}))),this.generateKeyPair=function(){n.isInitialized();var s=Object(_.p)();return n.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s){var t,a,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.getClientSeed();case 3:return t=e.sent,a=P.generateKeyPair(t),r=Object(_.q)(),o=yt,e.next=9,P.signJWT(r,s,o,a);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.generateSharedKey=function(s,e,a){n.isInitialized();var t=n.getPrivateKey(s),r=Object(_.h)(t,e);return n.setSymKey(r,a)},this.setSymKey=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s,t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),a=t||Object(_.z)(s),e.next=4,n.keychain.set(a,s);case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.deleteKeyPair=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.keychain.del(s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteSymKey=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.keychain.del(s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.encode=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s,t,a){var r,o,b,c,l,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isInitialized(),r=Object(_.mb)(a),o=Object(I.b)(t),!Object(_.K)(r)){e.next=7;break}return b=r.senderPublicKey,c=r.receiverPublicKey,e.next=6,n.generateSharedKey(b,c);case 6:s=e.sent;case 7:return l=n.getSymKey(s),h=r.type,f=r.senderPublicKey,e.abrupt("return",Object(_.j)({type:h,symKey:l,message:o,senderPublicKey:f}));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.decode=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s,t,a){var r,o,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isInitialized(),r=Object(_.lb)(t,a),!Object(_.K)(r)){e.next=7;break}return o=r.receiverPublicKey,c=r.senderPublicKey,e.next=6,n.generateSharedKey(o,c);case 6:s=e.sent;case 7:return l=n.getSymKey(s),h=Object(_.g)({symKey:l,encoded:t}),e.abrupt("return",Object(I.a)(h));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.getPayloadType=function(s){var e=Object(_.i)(s);return Object(_.f)(e.type)},this.getPayloadSenderPublicKey=function(s){var e=Object(_.i)(s);return e.senderPublicKey?Object(S.toString)(e.senderPublicKey,_.a):void 0},this.core=t,this.logger=Object(R.generateChildLogger)(r,this.name),this.keychain=i||new qt(this.core,this.logger)}var t,r;return Object(y.a)(e,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"setPrivateKey",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keychain.set(t,r);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"getPrivateKey",value:function(e){return this.keychain.get(e)}},{key:"getClientSeed",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="",e.prev=1,t=this.keychain.get(vt),e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(1),t=Object(_.q)(),e.next=10,this.keychain.set(vt,t);case 10:return e.abrupt("return",ht(t,"base16"));case 11:case"end":return e.stop()}}),e,this,[[1,5]])}))),function(){return t.apply(this,arguments)})},{key:"getSymKey",value:function(e){return this.keychain.get(e)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}(),Bt=function(e){Object(c.a)(l,e);var t,r,n,o=N(l);function l(e,t){var r;return Object(v.a)(this,l),(r=o.call(this,e,t)).logger=e,r.core=t,r.messages=new Map,r.name="messages",r.version="0.3",r.initialized=!1,r.storagePrefix=ft,r.init=Object(d.a)(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.initialized){e.next=15;break}return r.logger.trace("Initialized"),e.prev=2,e.next=5,r.getRelayerMessages();case 5:i=e.sent,Object(f.a)(i)<"u"&&(r.messages=i),r.logger.debug("Successfully Restored records for ".concat(r.name)),r.logger.trace({type:"method",method:"restore",size:r.messages.size}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),r.logger.debug("Failed to Restore records for ".concat(r.name)),r.logger.error(e.t0);case 12:return e.prev=12,r.initialized=!0,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,9,12,15]])}))),r.set=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),t=Object(_.A)(s),a=r.messages.get(i),Object(f.a)(a)>"u"&&(a={}),e.t0=Object(f.a)(a[t])<"u",e.t0){e.next=10;break}return a[t]=s,r.messages.set(i,a),e.next=10,r.persist();case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.get=function(i){r.isInitialized();var s=r.messages.get(i);return Object(f.a)(s)>"u"&&(s={}),s},r.has=function(i,s){r.isInitialized();var e=r.get(i),a=Object(_.A)(s);return Object(f.a)(e[a])<"u"},r.del=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.messages.delete(i),e.next=4,r.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.logger=Object(R.generateChildLogger)(e,r.name),r.core=t,r}return Object(y.a)(l,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setRelayerMessages",value:(n=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,Object(_.fb)(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getRelayerMessages",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",Object(f.a)(t)<"u"?Object(_.hb)(t):void 0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"persist",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerMessages(this.messages);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),l}(E.e),Jt=function(e){Object(c.a)(r,e);var t=N(r);function r(e,n){var o;return Object(v.a)(this,r),(o=t.call(this,e,n)).relayer=e,o.logger=n,o.events=new x.EventEmitter,o.name="publisher",o.queue=new Map,o.publishTimeout=1e4,o.publish=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s,t){var a,r,n,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.logger.debug("Publishing Payload"),o.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:t}}),e.prev=1,a=(null==t?void 0:t.ttl)||xt,r=Object(_.v)(t),n=(null==t?void 0:t.prompt)||!1,c=(null==t?void 0:t.tag)||0,l=(null==t?void 0:t.id)||Object(C.getBigIntRpcId)().toString(),h={topic:i,message:s,opts:{ttl:a,relay:r,prompt:n,tag:c,id:l}},o.queue.set(l,h),e.prev=4,e.next=7,Object(_.e)(o.rpcPublish(i,s,a,r,n,c,l),o.publishTimeout);case 7:return e.next=9,e.sent;case 9:o.relayer.events.emit(g.publish,h),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(4),o.logger.debug("Publishing Payload stalled"),o.relayer.events.emit(g.connection_stalled),e.abrupt("return");case 16:o.logger.debug("Successfully Published Payload"),o.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:t}}),e.next=22;break;case 19:throw e.prev=19,e.t1=e.catch(1),o.logger.debug("Failed to Publish Payload"),o.logger.error(e.t1),e.t1;case 22:case"end":return e.stop()}}),e,null,[[1,19],[4,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),o.on=function(i,s){o.events.on(i,s)},o.once=function(i,s){o.events.once(i,s)},o.off=function(i,s){o.events.off(i,s)},o.removeListener=function(i,s){o.events.removeListener(i,s)},o.relayer=e,o.logger=Object(R.generateChildLogger)(n,o.name),o.registerEventListeners(),o}return Object(y.a)(r,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"rpcPublish",value:function(e,t,i,s,r,a,n){var o,c,l,h,b={method:Object(_.u)(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:r,tag:a},id:n};return Object(_.L)(null==(o=b.params)?void 0:o.prompt)&&(null==(c=b.params)||delete c.prompt),Object(_.L)(null==(l=b.params)?void 0:l.tag)&&(null==(h=b.params)||delete h.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:b}),this.relayer.request(b)}},{key:"onPublish",value:function(e){this.queue.delete(e)}},{key:"checkQueue",value:function(){var e=this;this.queue.forEach(function(){var t=Object(d.a)(regeneratorRuntime.mark((function t(r){var n,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.topic,i=r.message,s=r.opts,t.next=3,e.publish(n,i,s);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(j.HEARTBEAT_EVENTS.pulse,(function(){e.checkQueue()})),this.relayer.on(g.message_ack,(function(t){e.onPublish(t.id.toString())}))}}]),r}(E.f),Ht=function(){function e(){var t=this;Object(v.a)(this,e),this.map=new Map,this.set=function(e,r){var i=t.get(e);t.exists(e,r)||t.map.set(e,[].concat(Object(o.a)(i),[r]))},this.get=function(e){return t.map.get(e)||[]},this.exists=function(e,r){return t.get(e).includes(r)},this.delete=function(e,r){if(Object(f.a)(r)>"u")t.map.delete(e);else if(t.map.has(e)){var i=t.get(e);if(t.exists(e,r)){var s=i.filter((function(e){return e!==r}));s.length?t.map.set(e,s):t.map.delete(e)}}},this.clear=function(){t.map.clear()}}return Object(y.a)(e,[{key:"topics",get:function(){return Array.from(this.map.keys())}}]),e}(),Wt=Object.defineProperty,Yt=Object.defineProperties,Ft=Object.getOwnPropertyDescriptors,Gt=Object.getOwnPropertySymbols,Zt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable,Xt=function(e,t,r){return t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},$t=function(e,t){for(var r in t||(t={}))Zt.call(t,r)&&Xt(e,r,t[r]);if(Gt){var n,o=U(Gt(t));try{for(o.s();!(n=o.n()).done;){r=n.value;Qt.call(t,r)&&Xt(e,r,t[r])}}catch(e){o.e(e)}finally{o.f()}}return e},er=function(e,t){return Yt(e,Ft(t))},rr=function(e){Object(c.a)(C,e);var t,r,n,o,l,h,m,w,O,k,E,I,P,S,T=N(C);function C(e,t){var r;return Object(v.a)(this,C),(r=T.call(this,e,t)).relayer=e,r.logger=t,r.subscriptions=new Map,r.topicMap=new Ht,r.events=new x.EventEmitter,r.name="subscription",r.version="0.3",r.pending=new Map,r.cached=[],r.initialized=!1,r.pendingSubscriptionWatchLabel="pending_sub_watch_label",r.pollingInterval=20,r.storagePrefix=ft,r.subscribeTimeout=1e4,r.restartInProgress=!1,r.batchSubscribeTopicsLimit=500,r.init=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=10;break}return r.logger.trace("Initialized"),e.next=5,r.restart();case 5:return r.registerEventListeners(),r.onEnable(),e.next=9,r.relayer.core.crypto.getClientId();case 9:r.clientId=e.sent;case 10:case"end":return e.stop()}}),e)}))),r.subscribe=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.restartToComplete();case 2:return r.isInitialized(),r.logger.debug("Subscribing Topic"),r.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),e.prev=5,t=Object(_.v)(s),a={topic:i,relay:t},r.pending.set(i,a),e.next=10,r.rpcSubscribe(i,t);case 10:return n=e.sent,e.abrupt("return",(r.onSubscribe(n,a),r.logger.debug("Successfully Subscribed Topic"),r.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),n));case 14:throw e.prev=14,e.t0=e.catch(5),r.logger.debug("Failed to Subscribe Topic"),r.logger.error(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,r){return e.apply(this,arguments)}}(),r.unsubscribe=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.restartToComplete();case 2:if(r.isInitialized(),!(Object(f.a)(null==s?void 0:s.id)<"u")){e.next=8;break}return e.next=6,r.unsubscribeById(i,s.id,s);case 6:e.next=10;break;case 8:return e.next=10,r.unsubscribeByTopic(i,s);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.isSubscribed=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.topics.includes(i)){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,new Promise((function(s,e){var a=new z.Watch;a.start(r.pendingSubscriptionWatchLabel);var t=setInterval((function(){!r.pending.has(i)&&r.topics.includes(i)&&(clearInterval(t),a.stop(r.pendingSubscriptionWatchLabel),s(!0)),a.elapsed(r.pendingSubscriptionWatchLabel)>=Tt&&(clearInterval(t),a.stop(r.pendingSubscriptionWatchLabel),e(new Error("Subscription resolution timeout")))}),r.pollingInterval)})).catch((function(){return!1}));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.on=function(i,s){r.events.on(i,s)},r.once=function(i,s){r.events.once(i,s)},r.off=function(i,s){r.events.off(i,s)},r.removeListener=function(i,s){r.events.removeListener(i,s)},r.restart=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.restartInProgress=!0,e.next=3,r.restore();case 3:return e.next=5,r.reset();case 5:r.restartInProgress=!1;case 6:case"end":return e.stop()}}),e)}))),r.relayer=e,r.logger=Object(R.generateChildLogger)(t,r.name),r.clientId="",r}return Object(y.a)(C,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.subscriptions.size}},{key:"ids",get:function(){return Array.from(this.subscriptions.keys())}},{key:"values",get:function(){return Array.from(this.subscriptions.values())}},{key:"topics",get:function(){return this.topicMap.topics}},{key:"hasSubscription",value:function(e,t){var i=!1;try{i=this.getSubscription(e).topic===t}catch(e){}return i}},{key:"onEnable",value:function(){this.cached=[],this.initialized=!0}},{key:"onDisable",value:function(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}},{key:"unsubscribeByTopic",value:(S=Object(d.a)(regeneratorRuntime.mark((function e(t,r){var i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.topicMap.get(t),e.next=3,Promise.all(i.map(function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.unsubscribeById(t,s,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"unsubscribeById",value:(P=Object(d.a)(regeneratorRuntime.mark((function e(t,r,i){var s,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:i}}),e.prev=1,s=Object(_.v)(i),e.next=5,this.rpcUnsubscribe(t,r,s);case 5:return n=Object(_.x)("USER_DISCONNECTED","".concat(this.name,", ").concat(t)),e.next=8,this.onUnsubscribe(t,r,n);case 8:this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:i}}),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t,r){return P.apply(this,arguments)})},{key:"rpcSubscribe",value:(I=Object(d.a)(regeneratorRuntime.mark((function e(t,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:Object(_.u)(r.protocol).subscribe,params:{topic:t}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),e.prev=2,e.next=5,Object(_.e)(this.relayer.request(i),this.subscribeTimeout);case 5:return e.next=7,e.sent;case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(g.connection_stalled);case 12:return e.abrupt("return",Object(_.A)(t+this.clientId));case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e,t){return I.apply(this,arguments)})},{key:"rpcBatchSubscribe",value:(E=Object(d.a)(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return r=t[0].relay,i={method:Object(_.u)(r.protocol).batchSubscribe,params:{topics:t.map((function(s){return s.topic}))}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),e.prev=4,e.next=7,Object(_.e)(this.relayer.request(i),this.subscribeTimeout);case 7:return e.next=9,e.sent;case 9:return e.abrupt("return",e.sent);case 12:e.prev=12,e.t0=e.catch(4),this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(g.connection_stalled);case 15:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return E.apply(this,arguments)})},{key:"rpcUnsubscribe",value:function(e,t,i){var s={method:Object(_.u)(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}},{key:"onSubscribe",value:function(e,t){this.setSubscription(e,er($t({},t),{id:e})),this.pending.delete(t.topic)}},{key:"onBatchSubscribe",value:function(e){var t=this;e.length&&e.forEach((function(e){t.setSubscription(e.id,$t({},e)),t.pending.delete(e.topic)}))}},{key:"onUnsubscribe",value:(k=Object(d.a)(regeneratorRuntime.mark((function e(t,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,i),e.next=4,this.relayer.messages.del(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return k.apply(this,arguments)})},{key:"setRelayerSubscriptions",value:(O=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"getRelayerSubscriptions",value:(w=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"setSubscription",value:function(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}},{key:"addSubscription",value:function(e,t){this.subscriptions.set(e,$t({},t)),this.topicMap.set(t.topic,e),this.events.emit(Pt,t)}},{key:"getSubscription",value:function(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});var t=this.subscriptions.get(e);if(!t){var i=Object(_.t)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(i)}return t}},{key:"deleteSubscription",value:function(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});var i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(_t,er($t({},i),{reason:t}))}},{key:"persist",value:(m=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerSubscriptions(this.values);case 2:this.events.emit(St);case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"reset",value:(h=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cached.length){e.next=10;break}t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit),r=0;case 3:if(!(r<t)){e.next=10;break}return i=this.cached.splice(0,this.batchSubscribeTopicsLimit),e.next=7,this.batchSubscribe(i);case 7:r++,e.next=3;break;case 10:this.events.emit(zt);case 11:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"restore",value:(l=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getRelayerSubscriptions();case 3:if(t=e.sent,!(Object(f.a)(t)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.subscriptions.size){e.next=9;break}throw r=Object(_.t)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),this.logger.error("".concat(this.name,": ").concat(JSON.stringify(this.values))),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored subscriptions for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore subscriptions for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return l.apply(this,arguments)})},{key:"batchSubscribe",value:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.rpcBatchSubscribe(t);case 4:r=e.sent,Object(_.M)(r)&&this.onBatchSubscribe(r.map((function(i,s){return er($t({},t[s]),{id:i})})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"onConnect",value:(n=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.restartInProgress,e.t0){e.next=5;break}return e.next=4,this.restart();case 4:this.onEnable();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onDisconnect",value:function(){this.onDisable()}},{key:"checkPending",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.relayer.transportExplicitlyClosed){e.next=2;break}return e.abrupt("return");case 2:return t=[],this.pending.forEach((function(e){t.push(e)})),e.next=6,this.batchSubscribe(t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(j.HEARTBEAT_EVENTS.pulse,Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkPending();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(g.connect,Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onConnect();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(g.disconnect,(function(){e.onDisconnect()})),this.events.on(Pt,function(){var t=Object(d.a)(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Pt,e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:r}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.events.on(_t,function(){var t=Object(d.a)(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_t,e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:r}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"restartToComplete",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.restartInProgress,!e.t0){e.next=4;break}return e.next=4,new Promise((function(e){var r=setInterval((function(){t.restartInProgress||(clearInterval(r),e())}),t.pollingInterval)}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),C}(E.j),nr=Object.defineProperty,ir=Object.getOwnPropertySymbols,br=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable,sr=function(e,t,r){return t in e?nr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},or=function(e,t){for(var r in t||(t={}))br.call(t,r)&&sr(e,r,t[r]);if(ir){var n,o=U(ir(t));try{for(o.s();!(n=o.n()).done;){r=n.value;ar.call(t,r)&&sr(e,r,t[r])}}catch(e){o.e(e)}finally{o.f()}}return e},cr=function(e){Object(c.a)(D,e);var t,r,o,l,h,m,w,O,k,j,E,I,P,S,L=N(D);function D(e){var t;return Object(v.a)(this,D),(t=L.call(this,e)).protocol="wc",t.version=2,t.events=new x.EventEmitter,t.name="relayer",t.transportExplicitlyClosed=!1,t.initialized=!1,t.reconnecting=!1,t.connectionStatusPollingInterval=20,t.staleConnectionErrors=["socket hang up","socket stalled"],t.request=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.logger.debug("Publishing Request Payload"),e.prev=1,e.next=4,t.toEstablishConnection();case 4:return e.next=6,t.provider.request(r);case 6:return e.abrupt("return",e.sent);case 9:throw e.prev=9,e.t0=e.catch(1),t.logger.debug("Failed to Publish Request"),t.logger.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),t.core=e.core,t.logger=Object(f.a)(e.logger)<"u"&&"string"!=typeof e.logger?Object(R.generateChildLogger)(e.logger,t.name):Object(R.pino)(Object(R.getDefaultLoggerOptions)({level:e.logger||"error"})),t.messages=new Bt(t.logger,e.core),t.subscriber=new rr(Object(n.a)(t),t.logger),t.publisher=new Jt(Object(n.a)(t),t.logger),t.relayUrl=(null==e?void 0:e.relayUrl)||Ot,t.projectId=e.projectId,t.provider={},t}return Object(y.a)(D,[{key:"init",value:(S=Object(d.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.next=3,this.createProvider();case 3:return e.next=5,Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]);case 5:this.registerEventListeners(),this.initialized=!0,setTimeout(Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=0===t.subscriber.topics.length,!e.t0){e.next=6;break}return t.logger.info("No topics subscribted to after init, closing transport"),e.next=5,t.transportClose();case 5:t.transportExplicitlyClosed=!1;case 6:case"end":return e.stop()}}),e)}))),1e4);case 8:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"connected",get:function(){return this.provider.connection.connected}},{key:"connecting",get:function(){return this.provider.connection.connecting}},{key:"publish",value:(P=Object(d.a)(regeneratorRuntime.mark((function e(t,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.publisher.publish(t,r,i);case 3:return e.next=5,this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()});case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return P.apply(this,arguments)})},{key:"subscribe",value:(I=Object(d.a)(regeneratorRuntime.mark((function e(t,r){var i,s,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized(),s=(null==(i=this.subscriber.topicMap.get(t))?void 0:i[0])||"",e.t0=s,e.t0){e.next=7;break}return e.next=6,Promise.all([new Promise((function(e){n.subscriber.once(Pt,(function(a){a.topic===t&&e()}))})),new Promise(function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.subscriber.subscribe(t,r);case 2:s=e.sent,o();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())]);case 6:e.t0=s;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"unsubscribe",value:(E=Object(d.a)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.subscriber.unsubscribe(t,r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"transportClose",value:(j=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transportExplicitlyClosed=!0,e.t0=this.connected,!e.t0){e.next=6;break}return e.next=5,this.provider.disconnect();case 5:this.events.emit(g.transport_closed);case 6:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"transportOpen",value:(k=Object(d.a)(regeneratorRuntime.mark((function e(t){var i,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transportExplicitlyClosed=!1,this.reconnecting){e.next=23;break}return this.relayUrl=t||this.relayUrl,this.reconnecting=!0,e.prev=2,e.t0=Promise,e.t1=new Promise((function(e){r.initialized||e(),r.subscriber.once(zt,(function(){e()}))})),e.next=7,Promise.race([new Promise(function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(t,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.e)(r.provider.connect(),5e3,"socket stalled").catch((function(s){return i(s)})).then((function(){return t()})).finally((function(){return r.removeListener(g.transport_closed,r.rejectTransportOpen)}));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),new Promise((function(e){return r.once(g.transport_closed,r.rejectTransportOpen)}))]);case 7:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=11,e.t0.all.call(e.t0,e.t3);case 11:e.next=20;break;case 13:if(e.prev=13,e.t4=e.catch(2),this.logger.error(e.t4),i=e.t4,this.isConnectionStalled(i.message)){e.next=19;break}throw e.t4;case 19:this.events.emit(g.transport_closed);case 20:return e.prev=20,this.reconnecting=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[2,13,20,23]])}))),function(e){return k.apply(this,arguments)})},{key:"restartTransport",value:(O=Object(d.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.transportExplicitlyClosed||this.reconnecting,e.t0){e.next=11;break}if(this.relayUrl=t||this.relayUrl,e.t1=this.connected,!e.t1){e.next=7;break}return e.next=7,Promise.all([new Promise((function(e){r.provider.once(Rt,(function(){e()}))})),this.transportClose()]);case 7:return e.next=9,this.createProvider();case 9:return e.next=11,this.transportOpen();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"isConnectionStalled",value:function(e){return this.staleConnectionErrors.some((function(t){return e.includes(t)}))}},{key:"rejectTransportOpen",value:function(){throw new Error("closeTransport called before connection was established")}},{key:"createProvider",value:(w=Object(d.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.crypto.signJWT(this.relayUrl);case 2:t=e.sent,this.provider=new T.a(new A.a(Object(_.m)({sdkVersion:"2.8.0",protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners();case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"recordMessageEvent",value:(m=Object(d.a)(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.message,e.next=3,this.messages.set(r,i);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"shouldIgnoreMessageEvent",value:(h=Object(d.a)(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.message,e.next=3,this.subscriber.isSubscribed(r);case 3:if(!e.sent){e.next=7;break}e.t0=this.messages.has(r,i),e.next=8;break;case 7:e.t0=!0;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"onProviderPayload",value:(l=Object(d.a)(regeneratorRuntime.mark((function e(t){var r,n,i,s,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),!Object(C.isJsonRpcRequest)(t)){e.next=13;break}if(t.method.endsWith("_subscription")){e.next=3;break}return e.abrupt("return");case 3:return r=t.params,n=r.data,i=n.topic,s=n.message,o=n.publishedAt,a={topic:i,message:s,publishedAt:o},this.logger.debug("Emitting Relayer Payload"),this.logger.trace(or({type:"event",event:r.id},a)),this.events.emit(r.id,a),e.next=9,this.acknowledgePayload(t);case 9:return e.next=11,this.onMessageEvent(a);case 11:e.next=14;break;case 13:Object(C.isJsonRpcResponse)(t)&&this.events.emit(g.message_ack,t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"onMessageEvent",value:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.shouldIgnoreMessageEvent(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return this.events.emit(g.message,t),e.next=7,this.recordMessageEvent(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"acknowledgePayload",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(C.formatJsonRpcResult)(t.id,!0),e.next=3,this.provider.connection.send(r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"registerProviderListeners",value:function(){var e=this;this.provider.on(kt,(function(t){return e.onProviderPayload(t)})),this.provider.on(jt,(function(){e.events.emit(g.connect)})),this.provider.on(Rt,(function(){e.onProviderDisconnect()})),this.provider.on(Et,(function(t){e.logger.error(t),e.events.emit(g.error,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.events.on(g.connection_stalled,Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))))}},{key:"onProviderDisconnect",value:function(){this.events.emit(g.disconnect),this.attemptToReconnect()}},{key:"attemptToReconnect",value:function(){var e=this;this.transportExplicitlyClosed||setTimeout(Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))),Object(z.toMiliseconds)(It))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"toEstablishConnection",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=7;break}if(!this.connecting){e.next=5;break}return e.next=4,new Promise((function(e){var r=setInterval((function(){t.connected&&(clearInterval(r),e())}),t.connectionStatusPollingInterval)}));case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.restartTransport();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),D}(E.g),ur=Object.defineProperty,pr=Object.getOwnPropertySymbols,lr=Object.prototype.hasOwnProperty,gr=Object.prototype.propertyIsEnumerable,fr=function(e,t,r){return t in e?ur(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},dr=function(e,t){for(var r in t||(t={}))lr.call(t,r)&&fr(e,r,t[r]);if(pr){var n,o=U(pr(t));try{for(o.s();!(n=o.n()).done;){r=n.value;gr.call(t,r)&&fr(e,r,t[r])}}catch(e){o.e(e)}finally{o.f()}}return e},mr=function(e){Object(c.a)(h,e);var t,r,n,o,l=N(h);function h(e,t,i){var r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ft,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return Object(v.a)(this,h),(r=l.call(this,e,t,i,s)).core=e,r.logger=t,r.name=i,r.map=new Map,r.version="0.3",r.cached=[],r.initialized=!1,r.storagePrefix=ft,r.init=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=8;break}return r.logger.trace("Initialized"),e.next=5,r.restore();case 5:r.cached.forEach((function(a){r.getKey&&null!==a&&!Object(_.L)(a)?r.map.set(r.getKey(a),a):Object(_.G)(a)?r.map.set(a.id,a):Object(_.J)(a)&&r.map.set(a.topic,a)})),r.cached=[],r.initialized=!0;case 8:case"end":return e.stop()}}),e)}))),r.set=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(a,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),!r.map.has(a)){e.next=6;break}return e.next=4,r.update(a,t);case 4:e.next=11;break;case 6:return r.logger.debug("Setting value"),r.logger.trace({type:"method",method:"set",key:a,value:t}),r.map.set(a,t),e.next=11,r.persist();case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.get=function(a){return r.isInitialized(),r.logger.debug("Getting value"),r.logger.trace({type:"method",method:"get",key:a}),r.getData(a)},r.getAll=function(a){return r.isInitialized(),a?r.values.filter((function(e){return Object.keys(a).every((function(t){return D()(e[t],a[t])}))})):r.values},r.update=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(a,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.logger.debug("Updating value"),r.logger.trace({type:"method",method:"update",key:a,update:t}),n=dr(dr({},r.getData(a)),t),r.map.set(a,n),e.next=5,r.persist();case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.delete=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(a,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),e.t0=r.map.has(a),!e.t0){e.next=8;break}return r.logger.debug("Deleting value"),r.logger.trace({type:"method",method:"delete",key:a,reason:t}),r.map.delete(a),e.next=8,r.persist();case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.logger=Object(R.generateChildLogger)(t,r.name),r.storagePrefix=s,r.getKey=n,r}return Object(y.a)(h,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.map.size}},{key:"keys",get:function(){return Array.from(this.map.keys())}},{key:"values",get:function(){return Array.from(this.map.values())}},{key:"setDataStore",value:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getDataStore",value:(n=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getData",value:function(e){var t=this.map.get(e);if(!t){var i=Object(_.t)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(i),new Error(i)}return t}},{key:"persist",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setDataStore(this.values);case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"restore",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getDataStore();case 3:if(t=e.sent,!(Object(f.a)(t)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.map.size){e.next=9;break}throw r=Object(_.t)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored value for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",value:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore value for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),h}(E.i),vr=function(){function e(t,r){var n=this;Object(v.a)(this,e),this.core=t,this.logger=r,this.name="pairing",this.version="0.3",this.events=new w.a,this.initialized=!1,this.storagePrefix=ft,this.ignoredPayloadTypes=[_.b],this.registeredMethods=[],this.init=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.initialized,e.t0){e.next=10;break}return e.next=4,n.pairings.init();case 4:return e.next=6,n.cleanup();case 6:n.registerRelayerEvents(),n.registerExpirerEvents(),n.initialized=!0,n.logger.trace("Initialized");case 10:case"end":return e.stop()}}),e)}))),this.register=function(e){var i=e.methods;n.isInitialized(),n.registeredMethods=Object(o.a)(new Set([].concat(Object(o.a)(n.registeredMethods),Object(o.a)(i))))},this.create=Object(d.a)(regeneratorRuntime.mark((function e(){var i,s,t,a,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),i=Object(_.q)(),e.next=4,n.core.crypto.setSymKey(i);case 4:return s=e.sent,t=Object(_.c)(z.FIVE_MINUTES),r={topic:s,expiry:t,relay:a={protocol:wt},active:!1},o=Object(_.o)({protocol:n.core.protocol,version:n.core.version,topic:s,symKey:i,relay:a}),e.next=11,n.pairings.set(s,r);case 11:return e.next=13,n.core.relayer.subscribe(s);case 13:return n.core.expirer.set(s,t),e.abrupt("return",{topic:s,uri:o});case 15:case"end":return e.stop()}}),e)}))),this.pair=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var t,s,r,a,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isInitialized(),n.isValidPair(i),t=Object(_.kb)(i.uri),s=t.topic,r=t.symKey,a=t.relay,!n.pairings.keys.includes(s)){e.next=4;break}throw new Error("Pairing already exists: ".concat(s));case 4:if(!n.core.crypto.hasKeys(s)){e.next=6;break}throw new Error("Keychain already exists: ".concat(s));case 6:return o=Object(_.c)(z.FIVE_MINUTES),c={topic:s,relay:a,expiry:o,active:!1},e.next=9,n.pairings.set(s,c);case 9:return e.next=11,n.core.crypto.setSymKey(r,s);case 11:return e.next=13,n.core.relayer.subscribe(s,{relay:a});case 13:if(n.core.expirer.set(s,o),e.t0=i.activatePairing,!e.t0){e.next=18;break}return e.next=18,n.activate({topic:s});case 18:return e.abrupt("return",c);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.activate=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(t){var i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.topic,n.isInitialized(),s=Object(_.c)(z.THIRTY_DAYS),e.next=5,n.pairings.update(i,{active:!0,expiry:s});case 5:n.core.expirer.set(i,s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.ping=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var s,t,r,a,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidPing(i);case 3:if(s=i.topic,!n.pairings.keys.includes(s)){e.next=15;break}return e.next=7,n.sendRequest(s,"wc_pairingPing",{});case 7:return t=e.sent,r=Object(_.d)(),a=r.done,o=r.resolve,c=r.reject,n.events.once(Object(_.k)("pairing_ping",t),(function(e){var t=e.error;t?c(t):o()})),e.next=15,a();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateExpiry=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(t){var i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.topic,s=t.expiry,n.isInitialized(),e.next=4,n.pairings.update(i,{expiry:s});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateMetadata=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(t){var i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.topic,s=t.metadata,n.isInitialized(),e.next=4,n.pairings.update(i,{peerMetadata:s});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPairings=function(){return n.isInitialized(),n.pairings.values},this.disconnect=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidDisconnect(i);case 3:if(s=i.topic,e.t0=n.pairings.keys.includes(s),!e.t0){e.next=10;break}return e.next=8,n.sendRequest(s,"wc_pairingDelete",Object(_.x)("USER_DISCONNECTED"));case 8:return e.next=10,n.deletePairing(s);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendRequest=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s,t){var a,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(C.formatJsonRpcRequest)(s,t),e.next=3,n.core.crypto.encode(i,a);case 3:return r=e.sent,o=Ct[s].req,e.abrupt("return",(n.core.history.set(i,a),n.core.relayer.publish(i,r,o),a.id));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.sendResult=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s,t){var a,r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(C.formatJsonRpcResult)(i,t),e.next=3,n.core.crypto.encode(s,a);case 3:return r=e.sent,e.next=6,n.core.history.get(s,i);case 6:return o=e.sent,c=Ct[o.request.method].res,e.next=10,n.core.relayer.publish(s,r,c);case 10:return e.next=12,n.core.history.resolve(a);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.sendError=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s,t){var a,r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(C.formatJsonRpcError)(i,t),e.next=3,n.core.crypto.encode(s,a);case 3:return r=e.sent,e.next=6,n.core.history.get(s,i);case 6:return o=e.sent,c=Ct[o.request.method]?Ct[o.request.method].res:Ct.unregistered_method.res,e.next=10,n.core.relayer.publish(s,r,c);case 10:return e.next=12,n.core.history.resolve(a);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.deletePairing=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.core.relayer.unsubscribe(i);case 2:return e.next=4,Promise.all([n.pairings.delete(i,Object(_.x)("USER_DISCONNECTED")),n.core.crypto.deleteSymKey(i),s?Promise.resolve():n.core.expirer.del(i)]);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.cleanup=Object(d.a)(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.pairings.getAll().filter((function(s){return Object(_.E)(s.expiry)})),e.next=3,Promise.all(i.map((function(s){return n.deletePairing(s.topic)})));case 3:case"end":return e.stop()}}),e)}))),this.onRelayEventRequest=function(i){var s=i.topic,e=i.payload,a=e.method;if(n.pairings.keys.includes(s))switch(a){case"wc_pairingPing":return n.onPairingPingRequest(s,e);case"wc_pairingDelete":return n.onPairingDeleteRequest(s,e);default:return n.onUnknownRpcMethodRequest(s,e)}},this.onRelayEventResponse=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var s,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=i.topic,t=i.payload,e.next=4,n.core.history.get(s,t.id);case 4:if(a=e.sent.request.method,!n.pairings.keys.includes(s)){e.next=11;break}e.t0=a,e.next="wc_pairingPing"===e.t0?9:10;break;case 9:return e.abrupt("return",n.onPairingPingResponse(s,t));case 10:return e.abrupt("return",n.onUnknownRpcMethodResponse(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onPairingPingRequest=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.id,e.prev=1,n.isValidPing({topic:i}),e.next=5,n.sendResult(t,i,!0);case 5:n.events.emit("pairing_ping",{id:t,topic:i}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(t,i,e.t0);case 12:n.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onPairingPingResponse=function(i,s){var e=s.id;setTimeout((function(){Object(C.isJsonRpcResult)(s)?n.events.emit(Object(_.k)("pairing_ping",e),{}):Object(C.isJsonRpcError)(s)&&n.events.emit(Object(_.k)("pairing_ping",e),{error:s.error})}),500)},this.onPairingDeleteRequest=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.id,e.prev=1,n.isValidDisconnect({topic:i}),e.next=5,n.deletePairing(i);case 5:n.events.emit("pairing_delete",{id:t,topic:i}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(t,i,e.t0);case 12:n.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodRequest=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.id,a=s.method,e.prev=1,!n.registeredMethods.includes(a)){e.next=4;break}return e.abrupt("return");case 4:return r=Object(_.x)("WC_METHOD_UNSUPPORTED",a),e.next=7,n.sendError(t,i,r);case 7:n.logger.error(r),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,n.sendError(t,i,e.t0);case 14:n.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodResponse=function(i){n.registeredMethods.includes(i)||n.logger.error(Object(_.x)("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=function(i){if(!Object(_.W)(i)){var s=Object(_.t)("MISSING_OR_INVALID","pair() params: ".concat(i)).message;throw new Error(s)}if(!Object(_.eb)(i.uri)){var e=Object(_.t)("MISSING_OR_INVALID","pair() uri: ".concat(i.uri)).message;throw new Error(e)}},this.isValidPing=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var t,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(_.W)(i)){e.next=3;break}throw t=Object(_.t)("MISSING_OR_INVALID","ping() params: ".concat(i)),r=t.message,new Error(r);case 3:return s=i.topic,e.next=6,n.isValidPairingTopic(s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidDisconnect=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var t,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(_.W)(i)){e.next=3;break}throw t=Object(_.t)("MISSING_OR_INVALID","disconnect() params: ".concat(i)),r=t.message,new Error(r);case 3:return s=i.topic,e.next=6,n.isValidPairingTopic(s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidPairingTopic=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var t,s,r,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(_.db)(i,!1)){e.next=3;break}throw t=Object(_.t)("MISSING_OR_INVALID","pairing topic should be a string: ".concat(i)),s=t.message,new Error(s);case 3:if(n.pairings.keys.includes(i)){e.next=6;break}throw r=Object(_.t)("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(i)),o=r.message,new Error(o);case 6:if(!Object(_.E)(n.pairings.get(i).expiry)){e.next=11;break}return e.next=9,n.deletePairing(i);case 9:throw c=Object(_.t)("EXPIRED","pairing topic: ".concat(i)),l=c.message,new Error(l);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=Object(R.generateChildLogger)(r,this.name),this.pairings=new mr(this.core,this.logger,this.name,this.storagePrefix)}return Object(y.a)(e,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"registerRelayerEvents",value:function(){var e=this;this.core.relayer.on(g.message,function(){var t=Object(d.a)(regeneratorRuntime.mark((function t(r){var n,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.topic,i=r.message,!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(i))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.core.crypto.decode(n,i);case 5:if(s=t.sent,!Object(C.isJsonRpcRequest)(s)){t.next=10;break}e.core.history.set(n,s),e.onRelayEventRequest({topic:n,payload:s}),t.next=15;break;case 10:if(t.t0=Object(C.isJsonRpcResponse)(s),!t.t0){t.next=15;break}return t.next=14,e.core.history.resolve(s);case 14:e.onRelayEventResponse({topic:n,payload:s});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerExpirerEvents",value:function(){var e=this;this.core.expirer.on(Ut.expired,function(){var t=Object(d.a)(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Object(_.ib)(r.target),o=n.topic,t.t0=o&&e.pairings.keys.includes(o),!t.t0){t.next=6;break}return t.next=5,e.deletePairing(o,!0);case 5:e.events.emit("pairing_expire",{topic:o});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),e}(),yr=function(e){Object(c.a)(h,e);var t,r,n,o,l=N(h);function h(e,t){var r;return Object(v.a)(this,h),(r=l.call(this,e,t)).core=e,r.logger=t,r.records=new Map,r.events=new x.EventEmitter,r.name="history",r.version="0.3",r.cached=[],r.initialized=!1,r.storagePrefix=ft,r.init=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=9;break}return r.logger.trace("Initialized"),e.next=5,r.restore();case 5:r.cached.forEach((function(i){return r.records.set(i.id,i)})),r.cached=[],r.registerEventListeners(),r.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),r.set=function(i,s,e){if(r.isInitialized(),r.logger.debug("Setting JSON-RPC request history record"),r.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:e}),!r.records.has(s.id)){var a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:e};r.records.set(a.id,a),r.events.emit(At,a)}},r.resolve=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),r.logger.debug("Updating JSON-RPC response history record"),r.logger.trace({type:"method",method:"update",response:i}),r.records.has(i.id)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.getRecord(i.id);case 4:s=e.sent,Object(f.a)(s.response)>"u"&&(s.response=Object(C.isJsonRpcError)(i)?{error:i.error}:{result:i.result},r.records.set(s.id,s),r.events.emit(Lt,s));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.get=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.logger.debug("Getting record"),r.logger.trace({type:"method",method:"get",topic:i,id:s}),e.next=5,r.getRecord(s);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.delete=function(i,s){r.isInitialized(),r.logger.debug("Deleting record"),r.logger.trace({type:"method",method:"delete",id:s}),r.values.forEach((function(e){if(e.topic===i){if(Object(f.a)(s)<"u"&&e.id!==s)return;r.records.delete(e.id),r.events.emit(Dt,e)}}))},r.exists=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),!r.records.has(s)){e.next=9;break}return e.next=4,r.getRecord(s);case 4:e.t1=e.sent.topic,e.t2=i,e.t0=e.t1===e.t2,e.next=10;break;case 9:e.t0=!1;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.on=function(i,s){r.events.on(i,s)},r.once=function(i,s){r.events.once(i,s)},r.off=function(i,s){r.events.off(i,s)},r.removeListener=function(i,s){r.events.removeListener(i,s)},r.logger=Object(R.generateChildLogger)(t,r.name),r}return Object(y.a)(h,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"size",get:function(){return this.records.size}},{key:"keys",get:function(){return Array.from(this.records.keys())}},{key:"values",get:function(){return Array.from(this.records.values())}},{key:"pending",get:function(){var e=[];return this.values.forEach((function(t){if(!(Object(f.a)(t.response)<"u")){var i={topic:t.topic,request:Object(C.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}})),e}},{key:"setJsonRpcRecords",value:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getJsonRpcRecords",value:(n=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getRecord",value:function(e){this.isInitialized();var t=this.records.get(e);if(!t){var i=Object(_.t)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(i)}return t}},{key:"persist",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setJsonRpcRecords(this.values);case 2:this.events.emit(Nt);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"restore",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getJsonRpcRecords();case 3:if(t=e.sent,!(Object(f.a)(t)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.records.size){e.next=9;break}throw r=Object(_.t)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",records:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"registerEventListeners",value:function(){var e=this;this.events.on(At,(function(t){var r=At;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.events.on(Lt,(function(t){var r=Lt;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.events.on(Dt,(function(t){var r=Dt;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),h}(E.d),xr=function(e){Object(c.a)(h,e);var t,r,n,o,l=N(h);function h(e,t){var r;return Object(v.a)(this,h),(r=l.call(this,e,t)).core=e,r.logger=t,r.expirations=new Map,r.events=new x.EventEmitter,r.name="expirer",r.version="0.3",r.cached=[],r.initialized=!1,r.storagePrefix=ft,r.init=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=9;break}return r.logger.trace("Initialized"),e.next=5,r.restore();case 5:r.cached.forEach((function(i){return r.expirations.set(i.target,i)})),r.cached=[],r.registerEventListeners(),r.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),r.has=function(i){try{var s=r.formatTarget(i);return Object(f.a)(r.getExpiration(s))<"u"}catch(e){return!1}},r.set=function(i,s){r.isInitialized();var e=r.formatTarget(i),a={target:e,expiry:s};r.expirations.set(e,a),r.checkExpiry(e,a),r.events.emit(Ut.created,{target:e,expiration:a})},r.get=function(i){r.isInitialized();var s=r.formatTarget(i);return r.getExpiration(s)},r.del=function(i){if(r.isInitialized(),r.has(i)){var s=r.formatTarget(i),e=r.getExpiration(s);r.expirations.delete(s),r.events.emit(Ut.deleted,{target:s,expiration:e})}},r.on=function(i,s){r.events.on(i,s)},r.once=function(i,s){r.events.once(i,s)},r.off=function(i,s){r.events.off(i,s)},r.removeListener=function(i,s){r.events.removeListener(i,s)},r.logger=Object(R.generateChildLogger)(t,r.name),r}return Object(y.a)(h,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.expirations.size}},{key:"keys",get:function(){return Array.from(this.expirations.keys())}},{key:"values",get:function(){return Array.from(this.expirations.values())}},{key:"formatTarget",value:function(e){if("string"==typeof e)return Object(_.n)(e);if("number"==typeof e)return Object(_.l)(e);var t=Object(_.t)("UNKNOWN_TYPE","Target type: ".concat(Object(f.a)(e))).message;throw new Error(t)}},{key:"setExpirations",value:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getExpirations",value:(n=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"persist",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setExpirations(this.values);case 2:this.events.emit(Ut.sync);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"restore",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getExpirations();case 3:if(t=e.sent,!(Object(f.a)(t)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.expirations.size){e.next=9;break}throw r=Object(_.t)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored expirations for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",expirations:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore expirations for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"getExpiration",value:function(e){var t=this.expirations.get(e);if(!t){var i=Object(_.t)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(i),new Error(i)}return t}},{key:"checkExpiry",value:function(e,t){var i=t.expiry;Object(z.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}},{key:"expire",value:function(e,t){this.expirations.delete(e),this.events.emit(Ut.expired,{target:e,expiration:t})}},{key:"checkExpirations",value:function(){var e=this;this.core.relayer.connected&&this.expirations.forEach((function(t,r){return e.checkExpiry(r,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.core.heartbeat.on(j.HEARTBEAT_EVENTS.pulse,(function(){return e.checkExpirations()})),this.events.on(Ut.created,(function(t){var r=Ut.created;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()})),this.events.on(Ut.expired,(function(t){var r=Ut.expired;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()})),this.events.on(Ut.deleted,(function(t){var r=Ut.deleted;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=Object(_.t)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),h}(E.c),wr=function(t){Object(c.a)(n,t);var r=N(n);function n(t,o){var c;return Object(v.a)(this,n),(c=r.call(this,t,o)).projectId=t,c.logger=o,c.name=Mt,c.initialized=!1,c.init=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(_.H)()||!Object(_.B)(),e.t0){e.next=5;break}return c.verifyUrl=(null==i?void 0:i.verifyUrl)||Kt,e.next=5,c.createIframe();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.register=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=c.initialized,e.t0){e.next=4;break}return e.next=4,c.init();case 4:c.iframe&&(null==(s=c.iframe.contentWindow)||s.postMessage(i.attestationId,c.verifyUrl),c.logger.info("postMessage sent: ".concat(i.attestationId," ").concat(c.verifyUrl)));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.resolve=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(i){var s,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.isDevEnv){e.next=2;break}return e.abrupt("return","");case 2:return c.logger.info("resolving attestation: ".concat(i.attestationId)),t=c.startAbortTimer(z.FIVE_SECONDS),e.next=6,fetch("".concat(c.verifyUrl,"/attestation/").concat(i.attestationId),{signal:c.abortController.signal});case 6:if(a=e.sent,clearTimeout(t),200!==a.status){e.next=20;break}return e.next=11,a.json();case 11:if(e.t1=s=e.sent,null!=e.t1){e.next=16;break}e.t2=void 0,e.next=17;break;case 16:e.t2=s.origin;case 17:e.t0=e.t2,e.next=21;break;case 20:e.t0="";case 21:return e.abrupt("return",e.t0);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.createIframe=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.race([new Promise((function(i,s){if(document.getElementById(Mt))return i();var e=document.createElement("iframe");e.setAttribute("id",Mt),e.setAttribute("src","".concat(c.verifyUrl,"/").concat(c.projectId)),e.style.display="none",e.addEventListener("load",(function(){c.initialized=!0,i()})),e.addEventListener("error",(function(a){s(a)})),document.body.append(e),c.iframe=e})),new Promise((function(i){setTimeout((function(){return i("iframe load timeout")}),Object(z.toMiliseconds)(z.ONE_SECOND/2))}))]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),c.logger.error("Verify iframe failed to load: ".concat(c.verifyUrl)),c.logger.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),c.logger=Object(R.generateChildLogger)(o,c.name),c.verifyUrl=Kt,c.abortController=new AbortController,c.isDevEnv=Object(_.F)()&&e.env.IS_VITEST,c}return Object(y.a)(n,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"startAbortTimer",value:function(e){var t=this;return setTimeout((function(){return t.abortController.abort()}),Object(z.toMiliseconds)(e))}}]),n}(E.k),Or=Object.defineProperty,kr=Object.getOwnPropertySymbols,jr=Object.prototype.hasOwnProperty,Rr=Object.prototype.propertyIsEnumerable,Er=function(e,t,r){return t in e?Or(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Ir=function(e,t){for(var r in t||(t={}))jr.call(t,r)&&Er(e,r,t[r]);if(kr){var n,o=U(kr(t));try{for(o.s();!(n=o.n()).done;){r=n.value;Rr.call(t,r)&&Er(e,r,t[r])}}catch(e){o.e(e)}finally{o.f()}}return e},Pr=function(e){Object(c.a)(h,e);var t,r,o,l=N(h);function h(e){var t;Object(v.a)(this,h),(t=l.call(this,e)).protocol="wc",t.version=2,t.name=gt,t.events=new x.EventEmitter,t.initialized=!1,t.on=function(i,s){return t.events.on(i,s)},t.once=function(i,s){return t.events.once(i,s)},t.off=function(i,s){return t.events.off(i,s)},t.removeListener=function(i,s){return t.events.removeListener(i,s)},t.projectId=null==e?void 0:e.projectId,t.relayUrl=(null==e?void 0:e.relayUrl)||Ot;var r=Object(f.a)(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:Object(R.pino)(Object(R.getDefaultLoggerOptions)({level:(null==e?void 0:e.logger)||bt}));return t.logger=Object(R.generateChildLogger)(r,t.name),t.heartbeat=new j.HeartBeat,t.crypto=new Vt(Object(n.a)(t),t.logger,null==e?void 0:e.keychain),t.history=new yr(Object(n.a)(t),t.logger),t.expirer=new xr(Object(n.a)(t),t.logger),t.storage=null!=e&&e.storage?e.storage:new k.a(Ir(Ir({},mt),null==e?void 0:e.storageOptions)),t.relayer=new cr({core:Object(n.a)(t),logger:t.logger,relayUrl:t.relayUrl,projectId:t.projectId}),t.pairing=new vr(Object(n.a)(t),t.logger),t.verify=new wr(t.projectId||"",t.logger),t}return Object(y.a)(h,[{key:"context",get:function(){return Object(R.getLoggerContext)(this.logger)}},{key:"start",value:(o=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"initialize",value:(r=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.prev=1,e.next=4,this.crypto.init();case 4:return e.next=6,this.history.init();case 6:return e.next=8,this.expirer.init();case 8:return e.next=10,this.relayer.init();case 10:return e.next=12,this.heartbeat.init();case 12:return e.next=14,this.pairing.init();case 14:this.initialized=!0,this.logger.info("Core Initialization Success"),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(1),this.logger.warn("Core Initialization Failure at epoch ".concat(Date.now()),e.t0),this.logger.error(e.t0.message),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,18]])}))),function(){return r.apply(this,arguments)})}],[{key:"init",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new h(t),e.next=3,r.initialize();case 3:return e.next=5,r.crypto.getClientId();case 5:return i=e.sent,e.next=8,r.storage.setItem("WALLETCONNECT_CLIENT_ID",i);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),h}(E.a),_r=Pr}).call(this,r(74))}}]);